"use strict";(self.webpackChunktrouts_blog=self.webpackChunktrouts_blog||[]).push([[3725],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>h});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=a.createContext({}),c=function(e){var t=a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(r),h=n,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||o;return r?a.createElement(m,i(i({ref:t},p),{},{components:r})):a.createElement(m,i({ref:t},p))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var c=2;c<o;c++)i[c]=r[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},4454:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=r(7462),n=(r(7294),r(3905));const o={slug:"clean-architecture",title:"Clean Architecture",authors:"trout",tags:["javascript"]},i=void 0,l={permalink:"/trouts-blog/blog/clean-architecture",editUrl:"https://github.com/christroutner/trouts-blog/blog/2021-07-06-clean-architecture/index.md",source:"@site/blog/2021-07-06-clean-architecture/index.md",title:"Clean Architecture",description:"Clean Architecture is a software design pattern created by 'Uncle Bob'. There are two main advantages to using this design pattern:",date:"2021-07-06T00:00:00.000Z",formattedDate:"July 6, 2021",tags:[{label:"javascript",permalink:"/trouts-blog/blog/tags/javascript"}],readingTime:2.4,hasTruncateMarker:!1,authors:[{name:"Chris Troutner",title:"Senior JavaScript Developer",url:"https://github.com/christroutner",imageURL:"https://github.com/christroutner.png",key:"trout"}],frontMatter:{slug:"clean-architecture",title:"Clean Architecture",authors:"trout",tags:["javascript"]},prevItem:{title:"Web 3 Cash Stack",permalink:"/trouts-blog/blog/web3-cashstack"},nextItem:{title:"Freedom, Software, and Token Economics; a Short Story",permalink:"/trouts-blog/blog/freedom-software-token-economic-short-story"}},s={authorsImageUrls:[void 0]},c=[{value:"File Layout",id:"file-layout",level:2}],p={toc:c};function u(e){let{components:t,...o}=e;return(0,n.kt)("wrapper",(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Clean Architecture")," is a software design pattern created by ",(0,n.kt)("a",{parentName:"p",href:"https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"},"'Uncle Bob'"),". There are two main advantages to using this design pattern:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"It manages increasing complexity as new features and interfaces are added over time."),(0,n.kt)("li",{parentName:"ul"},"It provides defense against ",(0,n.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Software_rot"},"code rot")," by isolating the parts that rarely change from the parts that change frequently.")),(0,n.kt)("p",null,"I ran across ",(0,n.kt)("a",{parentName:"p",href:"https://youtu.be/CnailTcJV_U"},"this great video")," by Bill Sourour applying the Clean Architecture concepts to a REST API server built using node.js and the Express framework. After studying it for some time, I adapted the design patterns in that video and applied them to the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/Permissionless-Software-Foundation/ipfs-p2wdb-service"},"P2WDB")," and the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/Permissionless-Software-Foundation/ipfs-service-provider"},"ipfs-service-provider")," repositories."),(0,n.kt)("p",null,"In this video, I expand on the Bill's original video and show how I applied Clean Architecture to my own REST API server using the Koa framework."),(0,n.kt)("center",null,(0,n.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/LftjSIbHzbo",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),(0,n.kt)("p",null,"Code is split up into four groups:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Entities"),(0,n.kt)("li",{parentName:"ul"},"Use Cases"),(0,n.kt)("li",{parentName:"ul"},"Adapters"),(0,n.kt)("li",{parentName:"ul"},"Controllers")),(0,n.kt)("p",null,"Without knowing the patterns and reasoning behind Clean Architecture, the code will look 'weird' to most JavaScript developers. This is because Clean Architecture comes from outside the JavaScript world and some of it's core ideas (like dependency inversion) don't translate easily into JavaScript."),(0,n.kt)("h2",{id:"file-layout"},"File Layout"),(0,n.kt)("p",null,"The code in the ",(0,n.kt)("inlineCode",{parentName:"p"},"src")," folder of this repository is split up into four main directories: ",(0,n.kt)("inlineCode",{parentName:"p"},"entities"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"use-cases"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"adapaters"),", and ",(0,n.kt)("inlineCode",{parentName:"p"},"controllers"),". These directories reflect the arrangement of concerns in the Clean Architecture diagram:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Clean Architecture Diagram",src:r(4582).Z,width:"772",height:"567"})),(0,n.kt)("p",null,"The above diagram is reflected in the code. The Controllers and Adapters both make up the green circle. I distinguish between the two:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Controllers are ",(0,n.kt)("em",{parentName:"li"},"inputs")," that cause the app to react."),(0,n.kt)("li",{parentName:"ul"},"Adapters are ",(0,n.kt)("em",{parentName:"li"},"outputs")," that the app manipulates, like a database.")),(0,n.kt)("p",null,"The diagram below shows how dependencies are arranged in the P2WDB project:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Dependency Graph",src:r(5462).Z,width:"1403",height:"1263"})),(0,n.kt)("p",null,"Major features of the diagram above:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The blunt point of an arrow connects the file that depends on the file pointed to by the pointy end of the arrow."),(0,n.kt)("li",{parentName:"ul"},"The dependencies in the above diagram follow the dependency arrows in the Clean Architecture diagram."),(0,n.kt)("li",{parentName:"ul"},"This project is a Koa web server app. Koa is a framework and the entry point of Koa program loads the Controllers first."),(0,n.kt)("li",{parentName:"ul"},"The Controllers load the Adapters, then it loads the Use Cases, then finally the Entities. Each lower stage depends on the stage above it."),(0,n.kt)("li",{parentName:"ul"},"Dependency Injection is used heavily to pass dependencies to the individual libraries."),(0,n.kt)("li",{parentName:"ul"},"Encapsulation pattern is used for unit tests.")),(0,n.kt)("p",null,"Moving forward, I plan to use this design pattern in all my code. I spent a couple weeks refactoring the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/Permissionless-Software-Foundation/ipfs-service-provider"},"ipfs-service-provider")," to match these patterns and achieve 100% unit test coverage. That repository is intended to be a ",(0,n.kt)("em",{parentName:"p"},"boilerplate")," for create decentralized, censorship-resistant providers of web services. I encourage all JavaScript developers to study this pattern and fork my code for their own use."))}u.isMDXComponent=!0},4582:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/cleanarchitecture-26ac5f08c770e19c35a8ef38b905373f.jpg"},5462:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/p2wdb-clean-architecture-ef2c5b41aece44bbab83375e3d0e59ae.png"}}]);